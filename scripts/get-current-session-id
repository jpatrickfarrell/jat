#!/bin/bash
# Get the session ID for the current Claude Code session
#
# Strategy: Find the most recently modified /tmp/claude-session-*.txt file
# This works because the statusline updates the session file on every render,
# so the active session will have the newest timestamp.
#
# Returns: session ID (UUID) on stdout
# Exit code: 0 on success, 1 if no session file found

set -e

# Find most recent session file
session_file=$(ls -t /tmp/claude-session-*.txt 2>/dev/null | head -1)

if [[ -z "$session_file" ]] || [[ ! -f "$session_file" ]]; then
    echo "Error: No Claude Code session file found in /tmp" >&2
    echo "The statusline must run at least once to create the session file" >&2
    exit 1
fi

# Read and output the session ID
session_id=$(cat "$session_file" 2>/dev/null | tr -d '\n')

if [[ -z "$session_id" ]]; then
    echo "Error: Session file is empty: $session_file" >&2
    exit 1
fi

echo "$session_id"
